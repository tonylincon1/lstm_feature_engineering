{"cells":[{"cell_type":"markdown","source":["# Preparações"],"metadata":{"id":"S1SjD-NU1pmB"}},{"cell_type":"code","execution_count":null,"metadata":{"executionInfo":{"elapsed":103649,"status":"ok","timestamp":1654652256033,"user":{"displayName":"Antonio Santos","userId":"03265893617080544823"},"user_tz":180},"id":"_7vsZu4J0Jyk","colab":{"base_uri":"https://localhost:8080/"},"outputId":"c8c7ca03-8bae-4f81-ce27-feef08ab9783"},"outputs":[{"output_type":"stream","name":"stdout","text":["\u001b[K     |████████████████████████████████| 320 kB 21.9 MB/s \n","\u001b[K     |████████████████████████████████| 636 kB 41.2 MB/s \n","\u001b[K     |████████████████████████████████| 120 kB 57.7 MB/s \n","\u001b[K     |████████████████████████████████| 1.3 MB 56.2 MB/s \n","\u001b[K     |████████████████████████████████| 56 kB 4.3 MB/s \n","\u001b[K     |████████████████████████████████| 167 kB 46.8 MB/s \n","\u001b[K     |████████████████████████████████| 6.8 MB 54.2 MB/s \n","\u001b[K     |████████████████████████████████| 88 kB 8.1 MB/s \n","\u001b[K     |████████████████████████████████| 2.0 MB 41.1 MB/s \n","\u001b[K     |████████████████████████████████| 17.8 MB 396 kB/s \n","\u001b[K     |████████████████████████████████| 1.7 MB 29.9 MB/s \n","\u001b[?25h  Installing build dependencies ... \u001b[?25l\u001b[?25hdone\n","  Getting requirements to build wheel ... \u001b[?25l\u001b[?25hdone\n","  Installing backend dependencies ... \u001b[?25l\u001b[?25hdone\n","    Preparing wheel metadata ... \u001b[?25l\u001b[?25hdone\n","\u001b[K     |████████████████████████████████| 262 kB 4.8 MB/s \n","\u001b[K     |████████████████████████████████| 1.3 MB 46.4 MB/s \n","\u001b[K     |████████████████████████████████| 11.1 MB 44.6 MB/s \n","\u001b[K     |████████████████████████████████| 690 kB 45.5 MB/s \n","\u001b[K     |████████████████████████████████| 63 kB 1.7 MB/s \n","\u001b[K     |████████████████████████████████| 4.7 MB 35.9 MB/s \n","\u001b[K     |████████████████████████████████| 261 kB 36.2 MB/s \n","\u001b[K     |████████████████████████████████| 303 kB 59.6 MB/s \n","\u001b[K     |████████████████████████████████| 3.1 MB 33.2 MB/s \n","\u001b[K     |████████████████████████████████| 102 kB 8.9 MB/s \n","\u001b[K     |████████████████████████████████| 812 kB 47.5 MB/s \n","\u001b[K     |████████████████████████████████| 25.9 MB 15.4 MB/s \n","\u001b[K     |████████████████████████████████| 271 kB 38.6 MB/s \n","\u001b[K     |████████████████████████████████| 14.8 MB 242 kB/s \n","\u001b[K     |████████████████████████████████| 209 kB 70.9 MB/s \n","\u001b[K     |████████████████████████████████| 79 kB 8.2 MB/s \n","\u001b[K     |████████████████████████████████| 146 kB 66.3 MB/s \n","\u001b[K     |████████████████████████████████| 62 kB 937 kB/s \n","\u001b[K     |████████████████████████████████| 181 kB 47.6 MB/s \n","\u001b[K     |████████████████████████████████| 54 kB 2.7 MB/s \n","\u001b[K     |████████████████████████████████| 63 kB 1.9 MB/s \n","\u001b[K     |████████████████████████████████| 78 kB 7.9 MB/s \n","\u001b[K     |████████████████████████████████| 1.7 MB 55.9 MB/s \n","\u001b[?25h  Installing build dependencies ... \u001b[?25l\u001b[?25hdone\n","  Getting requirements to build wheel ... \u001b[?25l\u001b[?25hdone\n","  Installing backend dependencies ... \u001b[?25l\u001b[?25hdone\n","    Preparing wheel metadata ... \u001b[?25l\u001b[?25hdone\n","\u001b[K     |████████████████████████████████| 1.7 MB 31.1 MB/s \n","\u001b[K     |████████████████████████████████| 1.1 MB 41.5 MB/s \n","\u001b[?25h  Building wheel for htmlmin (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Building wheel for imagehash (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Building wheel for databricks-cli (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Building wheel for pyLDAvis (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Building wheel for pyod (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Building wheel for umap-learn (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Building wheel for pynndescent (setup.py) ... \u001b[?25l\u001b[?25hdone\n","\u001b[31mERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\n","xarray-einstats 0.2.2 requires numpy>=1.21, but you have numpy 1.19.5 which is incompatible.\n","tensorflow 2.8.2+zzzcolab20220527125636 requires numpy>=1.20, but you have numpy 1.19.5 which is incompatible.\n","google-colab 1.0.0 requires requests~=2.23.0, but you have requests 2.27.1 which is incompatible.\n","datascience 0.10.6 requires folium==0.2.1, but you have folium 0.8.3 which is incompatible.\n","albumentations 0.1.12 requires imgaug<0.2.7,>=0.2.5, but you have imgaug 0.2.9 which is incompatible.\u001b[0m\n"]}],"source":["!pip install pycaret==2.3.10 markupsafe==2.0.1 pyyaml==5.4.1 -qq"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4007,"status":"ok","timestamp":1654652260028,"user":{"displayName":"Antonio Santos","userId":"03265893617080544823"},"user_tz":180},"id":"TA9o4Sc6Qc6I","outputId":"9e8991ba-4fde-4fa2-f7cd-714e91709efd"},"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/distributed/config.py:20: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please read https://msg.pyyaml.org/load for full details.\n","  defaults = yaml.load(f)\n"]}],"source":["import pandas as pd\n","from pycaret.classification import *\n","from tqdm import tqdm"]},{"cell_type":"code","source":["import os \n","import numpy as np\n","import pandas as pd\n","\n","import lightgbm as lgb\n","\n","import keras \n","from keras.layers import *\n","from keras.optimizers import *\n","from keras.models import Model\n","\n","from sklearn.metrics import f1_score \n","from sklearn.model_selection import KFold\n","from keras import backend as K\n","from sklearn.neural_network import BernoulliRBM"],"metadata":{"id":"z6u34g1-cEId"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from google.colab import drive\n","\n","drive.mount('/content/drive')"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"pbmv4QPG2mlV","executionInfo":{"status":"ok","timestamp":1654652284191,"user_tz":180,"elapsed":21398,"user":{"displayName":"Antonio Santos","userId":"03265893617080544823"}},"outputId":"4ab85bc1-ec53-4ec5-85b8-cbb51228b9f6"},"execution_count":null,"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}]},{"cell_type":"markdown","metadata":{"id":"EzuQlWAIdlLY"},"source":["# Preparação"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"SmglVpXXQx7w"},"outputs":[],"source":["df_train_values = pd.read_csv(\"/content/drive/My Drive/Colab Notebooks/Richter's Predictor: Modeling Earthquake Damage/data/train_values.csv\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"-owqop2mQ46i"},"outputs":[],"source":["df_train__label_values = pd.read_csv(\"/content/drive/My Drive/Colab Notebooks/Richter's Predictor: Modeling Earthquake Damage/data/train_labels.csv\")"]},{"cell_type":"code","source":["df_teste_values = pd.read_csv(\"/content/drive/My Drive/Colab Notebooks/Richter's Predictor: Modeling Earthquake Damage/data/test_values.csv\")"],"metadata":{"id":"ySZDbujXdFdB"},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":270},"executionInfo":{"elapsed":22,"status":"ok","timestamp":1654652290891,"user":{"displayName":"Antonio Santos","userId":"03265893617080544823"},"user_tz":180},"id":"71GSlzD9Q7cY","outputId":"ee56bc23-319b-46b3-d804-d8e981106c81"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["   building_id  geo_level_1_id  geo_level_2_id  geo_level_3_id  \\\n","0       802906               6             487           12198   \n","1        28830               8             900            2812   \n","2        94947              21             363            8973   \n","3       590882              22             418           10694   \n","4       201944              11             131            1488   \n","\n","   count_floors_pre_eq  age  area_percentage  height_percentage  \\\n","0                    2   30                6                  5   \n","1                    2   10                8                  7   \n","2                    2   10                5                  5   \n","3                    2   10                6                  5   \n","4                    3   30                8                  9   \n","\n","  land_surface_condition foundation_type roof_type ground_floor_type  \\\n","0                      t               r         n                 f   \n","1                      o               r         n                 x   \n","2                      t               r         n                 f   \n","3                      t               r         n                 f   \n","4                      t               r         n                 f   \n","\n","  other_floor_type position plan_configuration  has_superstructure_adobe_mud  \\\n","0                q        t                  d                             1   \n","1                q        s                  d                             0   \n","2                x        t                  d                             0   \n","3                x        s                  d                             0   \n","4                x        s                  d                             1   \n","\n","   has_superstructure_mud_mortar_stone  has_superstructure_stone_flag  \\\n","0                                    1                              0   \n","1                                    1                              0   \n","2                                    1                              0   \n","3                                    1                              0   \n","4                                    0                              0   \n","\n","   has_superstructure_cement_mortar_stone  \\\n","0                                       0   \n","1                                       0   \n","2                                       0   \n","3                                       0   \n","4                                       0   \n","\n","   has_superstructure_mud_mortar_brick  \\\n","0                                    0   \n","1                                    0   \n","2                                    0   \n","3                                    0   \n","4                                    0   \n","\n","   has_superstructure_cement_mortar_brick  has_superstructure_timber  \\\n","0                                       0                          0   \n","1                                       0                          0   \n","2                                       0                          0   \n","3                                       0                          1   \n","4                                       0                          0   \n","\n","   has_superstructure_bamboo  has_superstructure_rc_non_engineered  \\\n","0                          0                                     0   \n","1                          0                                     0   \n","2                          0                                     0   \n","3                          1                                     0   \n","4                          0                                     0   \n","\n","   has_superstructure_rc_engineered  has_superstructure_other  \\\n","0                                 0                         0   \n","1                                 0                         0   \n","2                                 0                         0   \n","3                                 0                         0   \n","4                                 0                         0   \n","\n","  legal_ownership_status  count_families  has_secondary_use  \\\n","0                      v               1                  0   \n","1                      v               1                  0   \n","2                      v               1                  0   \n","3                      v               1                  0   \n","4                      v               1                  0   \n","\n","   has_secondary_use_agriculture  has_secondary_use_hotel  \\\n","0                              0                        0   \n","1                              0                        0   \n","2                              0                        0   \n","3                              0                        0   \n","4                              0                        0   \n","\n","   has_secondary_use_rental  has_secondary_use_institution  \\\n","0                         0                              0   \n","1                         0                              0   \n","2                         0                              0   \n","3                         0                              0   \n","4                         0                              0   \n","\n","   has_secondary_use_school  has_secondary_use_industry  \\\n","0                         0                           0   \n","1                         0                           0   \n","2                         0                           0   \n","3                         0                           0   \n","4                         0                           0   \n","\n","   has_secondary_use_health_post  has_secondary_use_gov_office  \\\n","0                              0                             0   \n","1                              0                             0   \n","2                              0                             0   \n","3                              0                             0   \n","4                              0                             0   \n","\n","   has_secondary_use_use_police  has_secondary_use_other  \n","0                             0                        0  \n","1                             0                        0  \n","2                             0                        0  \n","3                             0                        0  \n","4                             0                        0  "],"text/html":["\n","  <div id=\"df-fb35cb63-bae7-47de-a1a4-0bbaa7c4daa1\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>building_id</th>\n","      <th>geo_level_1_id</th>\n","      <th>geo_level_2_id</th>\n","      <th>geo_level_3_id</th>\n","      <th>count_floors_pre_eq</th>\n","      <th>age</th>\n","      <th>area_percentage</th>\n","      <th>height_percentage</th>\n","      <th>land_surface_condition</th>\n","      <th>foundation_type</th>\n","      <th>roof_type</th>\n","      <th>ground_floor_type</th>\n","      <th>other_floor_type</th>\n","      <th>position</th>\n","      <th>plan_configuration</th>\n","      <th>has_superstructure_adobe_mud</th>\n","      <th>has_superstructure_mud_mortar_stone</th>\n","      <th>has_superstructure_stone_flag</th>\n","      <th>has_superstructure_cement_mortar_stone</th>\n","      <th>has_superstructure_mud_mortar_brick</th>\n","      <th>has_superstructure_cement_mortar_brick</th>\n","      <th>has_superstructure_timber</th>\n","      <th>has_superstructure_bamboo</th>\n","      <th>has_superstructure_rc_non_engineered</th>\n","      <th>has_superstructure_rc_engineered</th>\n","      <th>has_superstructure_other</th>\n","      <th>legal_ownership_status</th>\n","      <th>count_families</th>\n","      <th>has_secondary_use</th>\n","      <th>has_secondary_use_agriculture</th>\n","      <th>has_secondary_use_hotel</th>\n","      <th>has_secondary_use_rental</th>\n","      <th>has_secondary_use_institution</th>\n","      <th>has_secondary_use_school</th>\n","      <th>has_secondary_use_industry</th>\n","      <th>has_secondary_use_health_post</th>\n","      <th>has_secondary_use_gov_office</th>\n","      <th>has_secondary_use_use_police</th>\n","      <th>has_secondary_use_other</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>802906</td>\n","      <td>6</td>\n","      <td>487</td>\n","      <td>12198</td>\n","      <td>2</td>\n","      <td>30</td>\n","      <td>6</td>\n","      <td>5</td>\n","      <td>t</td>\n","      <td>r</td>\n","      <td>n</td>\n","      <td>f</td>\n","      <td>q</td>\n","      <td>t</td>\n","      <td>d</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>v</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>28830</td>\n","      <td>8</td>\n","      <td>900</td>\n","      <td>2812</td>\n","      <td>2</td>\n","      <td>10</td>\n","      <td>8</td>\n","      <td>7</td>\n","      <td>o</td>\n","      <td>r</td>\n","      <td>n</td>\n","      <td>x</td>\n","      <td>q</td>\n","      <td>s</td>\n","      <td>d</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>v</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>94947</td>\n","      <td>21</td>\n","      <td>363</td>\n","      <td>8973</td>\n","      <td>2</td>\n","      <td>10</td>\n","      <td>5</td>\n","      <td>5</td>\n","      <td>t</td>\n","      <td>r</td>\n","      <td>n</td>\n","      <td>f</td>\n","      <td>x</td>\n","      <td>t</td>\n","      <td>d</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>v</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>590882</td>\n","      <td>22</td>\n","      <td>418</td>\n","      <td>10694</td>\n","      <td>2</td>\n","      <td>10</td>\n","      <td>6</td>\n","      <td>5</td>\n","      <td>t</td>\n","      <td>r</td>\n","      <td>n</td>\n","      <td>f</td>\n","      <td>x</td>\n","      <td>s</td>\n","      <td>d</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>v</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>201944</td>\n","      <td>11</td>\n","      <td>131</td>\n","      <td>1488</td>\n","      <td>3</td>\n","      <td>30</td>\n","      <td>8</td>\n","      <td>9</td>\n","      <td>t</td>\n","      <td>r</td>\n","      <td>n</td>\n","      <td>f</td>\n","      <td>x</td>\n","      <td>s</td>\n","      <td>d</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>v</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-fb35cb63-bae7-47de-a1a4-0bbaa7c4daa1')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-fb35cb63-bae7-47de-a1a4-0bbaa7c4daa1 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-fb35cb63-bae7-47de-a1a4-0bbaa7c4daa1');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":8}],"source":["df_train_values.head()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":206},"executionInfo":{"elapsed":17,"status":"ok","timestamp":1654652290892,"user":{"displayName":"Antonio Santos","userId":"03265893617080544823"},"user_tz":180},"id":"nuqKEYpoQ-A-","outputId":"7ccefdef-a8ae-44f1-e675-e98bf4e962f5"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["   building_id  damage_grade\n","0       802906             3\n","1        28830             2\n","2        94947             3\n","3       590882             2\n","4       201944             3"],"text/html":["\n","  <div id=\"df-b81257a5-ee0a-4c40-9338-85267693890e\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>building_id</th>\n","      <th>damage_grade</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>802906</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>28830</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>94947</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>590882</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>201944</td>\n","      <td>3</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-b81257a5-ee0a-4c40-9338-85267693890e')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-b81257a5-ee0a-4c40-9338-85267693890e button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-b81257a5-ee0a-4c40-9338-85267693890e');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":9}],"source":["df_train__label_values.head()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":350,"status":"ok","timestamp":1654652291227,"user":{"displayName":"Antonio Santos","userId":"03265893617080544823"},"user_tz":180},"id":"U7mZTZ7_Q_5u","outputId":"c0ac53b9-a494-4b95-d9e3-848c0a087b79"},"outputs":[{"output_type":"stream","name":"stdout","text":["(260601, 39)\n","(260601, 2)\n"]}],"source":["print(df_train_values.shape)\n","print(df_train__label_values.shape)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"gHl8gsL0RBqS"},"outputs":[],"source":["df_train = pd.merge(df_train_values,df_train__label_values,how='inner',on='building_id')"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4,"status":"ok","timestamp":1654652291843,"user":{"displayName":"Antonio Santos","userId":"03265893617080544823"},"user_tz":180},"id":"kGjxs-YNRDUq","outputId":"bfedc429-b9e2-4529-e00c-06ac6d392447"},"outputs":[{"output_type":"stream","name":"stdout","text":["(260601, 39)\n","(260601, 2)\n","(260601, 40)\n"]}],"source":["print(df_train_values.shape)\n","print(df_train__label_values.shape)\n","print(df_train.shape)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4,"status":"ok","timestamp":1654652291844,"user":{"displayName":"Antonio Santos","userId":"03265893617080544823"},"user_tz":180},"id":"wiIxHVBEREho","outputId":"58878f84-0c3f-414b-e565-d2633c0b1b03"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["2    148259\n","3     87218\n","1     25124\n","Name: damage_grade, dtype: int64"]},"metadata":{},"execution_count":13}],"source":["df_train.damage_grade.value_counts()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"XUiEdyyDRIzb"},"outputs":[],"source":["target = []\n","\n","for n in df_train.damage_grade:\n","    if n == 1:\n","        target.append(0)\n","    elif n == 2:\n","        target.append(1)\n","    elif n == 3:\n","        target.append(2)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"akbaNL-ZRLBG"},"outputs":[],"source":["df_train[\"damage_grade\"] = target"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":15,"status":"ok","timestamp":1654652292625,"user":{"displayName":"Antonio Santos","userId":"03265893617080544823"},"user_tz":180},"id":"4y8zYaYYRNEt","outputId":"4ab3fb8a-94b7-4913-a64c-e6fff640d13c"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["1    148259\n","2     87218\n","0     25124\n","Name: damage_grade, dtype: int64"]},"metadata":{},"execution_count":16}],"source":["df_train.damage_grade.value_counts()"]},{"cell_type":"markdown","source":["# MLPClassifier"],"metadata":{"id":"nFc4bb3ZoehJ"}},{"cell_type":"code","source":["df = df_train.drop([\"building_id\",\"damage_grade\"], axis=1)\n","\n","y = np.array(df_train[\"damage_grade\"])-1\n","\n","df = pd.concat([df,pd.get_dummies(df[[\"geo_level_1_id\",\"geo_level_2_id\",\"geo_level_3_id\",\"age\",\"land_surface_condition\",\"foundation_type\",\"roof_type\",\"ground_floor_type\",\"other_floor_type\",\"position\",\"plan_configuration\",\"legal_ownership_status\"]])], axis=1)\n","df = df.drop([\"foundation_type\",\"land_surface_condition\",\"roof_type\",\"ground_floor_type\",\"other_floor_type\",\"position\",\"plan_configuration\",\"legal_ownership_status\"], axis=1)\n","\n","x = np.array(df)"],"metadata":{"id":"5vwUd0CC_6q9"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["from sklearn.neural_network import MLPClassifier\n","from sklearn.datasets import make_classification\n","from sklearn.model_selection import train_test_split\n","\n","X_train, X_test, y_train, y_test = train_test_split(x, y, stratify=y,\n","                                                     random_state=1)\n","clf = MLPClassifier(random_state=1, max_iter=300).fit(X_train, y_train)\n","clf.predict_proba(X_test[:1])\n","clf.predict(X_test[:5, :])\n","clf.score(X_test, y_test)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"PAF7hXq1_eh-","executionInfo":{"status":"ok","timestamp":1654654988454,"user_tz":180,"elapsed":1586521,"user":{"displayName":"Antonio Santos","userId":"03265893617080544823"}},"outputId":"6290528b-9bee-4e5c-8899-34db401947a6"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["0.5938205092784454"]},"metadata":{},"execution_count":46}]},{"cell_type":"code","source":["df = df_teste_values.drop([\"building_id\"], axis=1)\n","\n","df = pd.concat([df,pd.get_dummies(df[[\"geo_level_1_id\",\"geo_level_2_id\",\"geo_level_3_id\",\"age\",\"land_surface_condition\",\"foundation_type\",\"roof_type\",\"ground_floor_type\",\"other_floor_type\",\"position\",\"plan_configuration\",\"legal_ownership_status\"]])], axis=1)\n","df = df.drop([\"foundation_type\",\"land_surface_condition\",\"roof_type\",\"ground_floor_type\",\"other_floor_type\",\"position\",\"plan_configuration\",\"legal_ownership_status\"], axis=1)\n","\n","x = np.array(df)"],"metadata":{"id":"iYqS1aNnIPiz"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["y_pred = clf.predict(x)"],"metadata":{"id":"9RsPEUs1H5eC"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["y_pred"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"sys17rquIfI0","executionInfo":{"status":"ok","timestamp":1654655164790,"user_tz":180,"elapsed":304,"user":{"displayName":"Antonio Santos","userId":"03265893617080544823"}},"outputId":"893ffff2-1c06-4a82-882b-0875d2f91b75"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["array([1, 0, 0, ..., 0, 0, 0])"]},"metadata":{},"execution_count":54}]},{"cell_type":"markdown","source":["# Create Submission File"],"metadata":{"id":"r-I_07_3rzrD"}},{"cell_type":"code","source":["sub_csv = pd.read_csv(\"/content/drive/My Drive/Colab Notebooks/Richter's Predictor: Modeling Earthquake Damage/data/submission_format.csv\")\n","\n","sub_csv[\"damage_grade\"] = y_pred + 2\n","sub_csv.to_csv(\"/content/drive/My Drive/Colab Notebooks/Richter's Predictor: Modeling Earthquake Damage/output/submit/teste_redes.csv\", index=False)"],"metadata":{"id":"rVHw49-zsHQA"},"execution_count":null,"outputs":[]},{"cell_type":"code","source":["sub_csv"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":424},"id":"hz04gMK9x7q4","executionInfo":{"status":"ok","timestamp":1654655272684,"user_tz":180,"elapsed":292,"user":{"displayName":"Antonio Santos","userId":"03265893617080544823"}},"outputId":"efe8ed8f-b202-45c6-c2f4-bff408f34da7"},"execution_count":null,"outputs":[{"output_type":"execute_result","data":{"text/plain":["       building_id  damage_grade\n","0           300051             3\n","1            99355             2\n","2           890251             2\n","3           745817             1\n","4           421793             3\n","...            ...           ...\n","86863       310028             2\n","86864       663567             3\n","86865      1049160             2\n","86866       442785             2\n","86867       501372             2\n","\n","[86868 rows x 2 columns]"],"text/html":["\n","  <div id=\"df-37fc6abf-08a2-4f1c-815e-399a7f8eaf32\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>building_id</th>\n","      <th>damage_grade</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>300051</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>99355</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>890251</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>745817</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>421793</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>86863</th>\n","      <td>310028</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>86864</th>\n","      <td>663567</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>86865</th>\n","      <td>1049160</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>86866</th>\n","      <td>442785</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>86867</th>\n","      <td>501372</td>\n","      <td>2</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>86868 rows × 2 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-37fc6abf-08a2-4f1c-815e-399a7f8eaf32')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-37fc6abf-08a2-4f1c-815e-399a7f8eaf32 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-37fc6abf-08a2-4f1c-815e-399a7f8eaf32');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":65}]},{"cell_type":"code","source":[""],"metadata":{"id":"FEav9KMuI6PE"},"execution_count":null,"outputs":[]}],"metadata":{"colab":{"collapsed_sections":["S1SjD-NU1pmB","EzuQlWAIdlLY","nFc4bb3ZoehJ","r-I_07_3rzrD"],"name":"Treinamento - Redes Neurais (MLPClassifier)","provenance":[],"authorship_tag":"ABX9TyNuJO70zMia/UgZhA6OCdJR"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}